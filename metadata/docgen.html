<!DOCTYPE html>
<html lang="en">
<head>
    <script defer src="https://cloud.umami.is/script.js" data-website-id="459f7581-de5e-40fb-a3c7-a330a23bfdaf"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate demo documents</title>
    <!-- Bootstrap CSS -->
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Bootstrap Icons -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.5.0/font/bootstrap-icons.css" rel="stylesheet">

<!-- jQuery CDN -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-jsonview/1.2.3/jquery.jsonview.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-jsonview/1.2.3/jquery.jsonview.min.js"></script>
    <!-- JSONEditor CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsoneditor/dist/jsoneditor.min.css">

<!-- JSONEditor JS -->
<script src="https://cdn.jsdelivr.net/npm/jsoneditor/dist/jsoneditor.min.js"></script>

    <script src="./lib/bundle.js"></script>
    <link rel="stylesheet" href="https://cdn01.boxcdn.net/platform/elements/22.0.0/en-US/explorer.css"/>
    <script src="https://cdn01.boxcdn.net/platform/elements/22.0.0/en-US/explorer.js"></script>
    <link rel="stylesheet" href="https://cdn01.boxcdn.net/platform/elements/22.0.0/en-US/picker.css"/>
<script src="https://cdn01.boxcdn.net/platform/elements/22.0.0/en-US/picker.js"></script>
<link rel="stylesheet" href="https://cdn01.boxcdn.net/platform/elements/21.0.0/en-US/preview.css"/>
<script src="https://cdn01.boxcdn.net/platform/elements/21.0.0/en-US/preview.js"></script>
<link rel="stylesheet" href="https://cdn01.boxcdn.net/platform/elements/21.0.0/en-US/explorer.css"/>
<script src="https://cdn01.boxcdn.net/platform/elements/21.0.0/en-US/explorer.js"></script>
<script src="metadata.js"></script>
<script src="docgen.js"></script>
<link rel="stylesheet" href="import.css"/>

    <style>
     .jsonview {
        font-size:10px;
        font-family: 'Courier New', Courier, monospace;

     }
     #fields {
        font-size:12px;
        font-family: 'Lato, "Helvetica Neue", Helvetica, Arial, sans-serif';
     }
    </style>

    <script>
        const { BoxClient, BoxDeveloperTokenAuth } =window['box-typescript-sdk-gen'];
        var client,eid,editor,createEditor,metadataTemplates;
        let selectedFile = null;
        let selectedFileName = null;
        var folderPicker = new Box.FolderPicker();
        var contentExplorer = new Box.ContentExplorer();
        var accessToken=sessionStorage.getItem("token");
        var tagsMap = [];
        var metadataMap = [];
        const completedBatches = new Set(); // Store completed batch IDs
        const completedWithErrorBatches = new Set(); // Store completed batch IDs

        $(document).ready(async function() {
            $("#create").click(async function() {
                $("#createModal").modal("show");
                $("#saveAsNewTemplate").hide();
                var picker = new Box.ContentExplorer();
                picker.show("0", accessToken,{
                    container: "#box-file-picker-create",
                    
                    canSetShareAccess:false,
                    logoUrl:'logo-small.png',
                    currentFolderId:'0',
                    rootFolderId:'0',
                    sortBy:'date',
                    sortDirection:'desc'

                    }
                );
                picker.addListener("preview", async function (response) {
                    $("#createLoader").show();
                    if(!response.file.name.endsWith('.docx')) {
                        document.getElementById('jsoneditor-create').innerHTML = 'Please select a .docx file';
                        $("#createLoader").hide();
                    } else {
                        $.each(response, function (k, data) {
                            selectedFile = data.id;
                            selectedFileName = data.name;
                            console.log(selectedFile);
                        });
                        let prompt = "I am creating a document generation template based on this document. I need you to scan the whole document, identify any variable data. " + 
                        " That means data that could be generated. Names, addresses, dates, values, IDs, account numbers and others. I need you to return these in a json structure. Only return valid JSON. No backticks or other unnecessary characters. " + 
                        ". Where it makes sense you can create child objects. Let the root be 'tags'. Let the value of the tag be the identified value. For example: {\"tags\":{\"name\":\"John Doe\",\"address\":{\"street\":\"123 Main St\",\"city\":\"Anytown\",\"state\":\"CA\",\"zip\":\"12345\"}}}";
                        let askResponse = await callBoxAIAPI(accessToken,prompt,selectedFile);
                        //Show loader in right col
                        let json = JSON.parse(askResponse.answer);
                        console.log(json);
                        //populate the json editor  
                        $("#createLoader").hide();
                        $("#saveAsNewTemplate").show();
                        //$("#jsonview-create").JSONView(json, { collapsed: false });
                        createEditor = new JSONEditor(document.getElementById('jsoneditor-create'), {
                            mode: 'tree', 
                            onChange: function () {
                                console.log('editor changed');
                                //const obj = tagsMap.find(item => item.id === id);
                                //if (obj) {
                                //    obj.json = editor.get();
                                //} else {
                                //    console.warn(`ID ${id} not found in array`);
                            // }
                                
                            }
                        });
                        createEditor.set(json);
                        //save the json
                        //Copy doc and replace values in new doc?
                    }

                });
                
            })
            $("#saveAsNewTemplate").click(async function() {
                $("#createLoader").show();
                let downloadUrl = await client.downloads.getDownloadFileUrl(selectedFile);
                let newFile = await $.ajax({
                    url: 'https://box-java-sandpit.herokuapp.com/docxreplacer',
                    type: 'POST',
                    data: {
                        docUrl: downloadUrl,
                        jsonData: JSON.stringify(createEditor.get()),
                        boxFileId: selectedFile,
                        boxToken:accessToken
                    },
                    success: function(response) {
                        console.log('File saved successfully:', response);
                        $("#createModal").modal("hide");
                        loadDocGenTemplates();
                    },
                    error: function(error) {
                        console.error('Error saving file:', error);
                    }
                });

            });
            $("#tryAI").click(async function() {
                $("#exampleModal").modal("show");
                $("#tryLoader").show();
                $("#jsonview").empty();
                //generate the json for json view
                let selectedTemplate = $("#allTemplates").find("option:selected").val();
                let response = await callBoxAIAPI(accessToken,getPrompt('fileName'),selectedTemplate, generateFieldHints(tagsMap.find(item => item.id === selectedTemplate).json))
                $("#tryLoader").hide();
                $("#jsonview").JSONView(JSON.parse(response.answer), { collapsed: false });

                //first load
                //then data
              });
              $(".toggle-btn").each(function () {
                var target = $($(this).data("bs-target"));
                var button = $(this);
        
                // Listen for when collapse completes opening
                target.on("shown.bs.collapse", function () {
                    button.html("[-]");
                });
        
                // Listen for when collapse completes closing
                target.on("hidden.bs.collapse", function () {
                    button.html("[+]");
                });
            });
            
            $("#toggleSection").on("change", function () {
                if ($(this).is(":checked")) {
                    $("#leftCol").removeClass("col-md-12").addClass("col-md-6");
                    $("#rightCol, #mdsection").fadeIn();
                } else {
                    $("#leftCol").removeClass("col-md-6").addClass("col-md-12");
                    $("#rightCol, #mdsection").fadeOut();
                }
            });
            $(document).on("click", ".bcpr-PreviewHeader-button-close", function() {
                $("#jsoneditor-create").empty();
            });
            
            $(document).on('click', 'input[type="radio"]', function() {
                // Check if the clicked radio button is NOT in the "docFormat" group
                if (!$(this).is('[name="docFormat"]')) {
                    const $button = $('button[aria-label="Choose"]');
            
                    if ($button.length) {
                        $button.click();
                    }
                }
            });
            
            try {
                //Create a Box client using the token
                client = new BoxClient({auth: new BoxDeveloperTokenAuth({token: accessToken }),
                });
               eid = getEid(client); 
            }
            catch (e) {
                console.error(e);
                
            }
            metadataTemplates = await client.metadataTemplates.getEnterpriseMetadataTemplates();
            metadataTemplates.entries.forEach(function(temp) {
                if(temp.hidden==false) {
                    $('#allMDTemplates').append($('<option>', {
                        value: temp.templateKey,
                        text: temp.displayName + ' (' + temp.templateKey + ')',
                    }));
                }
            })
            folderPicker.show('0', accessToken, {
                container: ".selector",
                maxSelectable:1,
                canSetShareAccess:false,
                logoUrl:'logo-small.png',
                currentFolderId:'0',
                rootFolderId:'0',
                sortBy:'date',
                sortDirection:'desc'

            });
            folderPicker.addListener("choose", async function (response) {
                $.each(response, function (k, data) {
                    selectedFolder = data.id;
                    selectedFolderName = data.name;
                    $("#folderHeader").text("Select target folder:" + selectedFolderName);
                    $("button.toggle-btn[data-bs-target='#row3']").trigger("click");

                    checkButton();
                 });
            });
            $(".action").click(function () {
                $(".action").attr("disabled",true);
                $(".counter").text('0');
                completedBatches.clear();
                completedWithErrorBatches.clear();
                $("#loaderGen").show();
                let type = $(this).attr('id');
                const docGenProcessor = new DocGenProcessor(client, 8);
                const aiProcessor = new AIProcessor(client, docGenProcessor,accessToken, 8);
                let templatesArray = [];
                templatesArray.push($("#allTemplates").find("option:selected").val());
                const numberOfDocs = parseInt($("#numberofdocs").val(), 10); // Get number of docs
                if (templatesArray.length === 0 || isNaN(numberOfDocs) || numberOfDocs <= 0) {
                    alert("Please select at least one template and enter a valid number of documents.");
                    return;
                }
                if(type==='generateAI') {
                    function* generateAiJobs() {
                        for (const templateId of templatesArray) {
                            for (let i = 0; i < numberOfDocs; i++) {
                                console.log('creating job:' + templateId);
                                console.log(tagsMap);
                                const boxFileId = templateId; 

                                // Use the Box file ID and template/document combination to create a unique fileId for the job
                                const uniqueFileId = `${boxFileId}_template_doc_${i + 1}`;
                                const fileName = $("#selectedTemplate option[value='" + boxFileId + "']").text();
                                yield {
                                    fileId: uniqueFileId,  
                                    boxFileId: boxFileId,  
                                    folderId: selectedFolder, 
                                    prompt: getPrompt(fileName),
                                    content: generateFieldHints(tagsMap.find(item => item.id === templateId).json)
                                };
                            }
                        }
                    }
                    aiProcessor.generateJobs(generateAiJobs); // Pass jobs to AI processor
                    console.log("AI jobs submitted.");
                
                }
                else {
                    for (const templateId of templatesArray) {
                        for (let i = 0; i < numberOfDocs; i++) {
                            const boxFileId = templateId; 
                            const uniqueFileId = `${boxFileId}_template_doc_${i + 1}`;
                            const fileName = $("#selectedTemplate option[value='" + boxFileId + "']").text();
                            let docGenJob = {
                                    uniqueId:uniqueFileId,
                                    uploadedFileId: boxFileId,
                                    folderId: selectedFolder,
                                    fileName: `Generated_${uniqueFileId}`,
                                    userInput:transformStaticJson(tagsMap.find(item => item.id === templateId).json)
                            }
                            docGenProcessor.addJob(docGenJob);
                        }
                    }
                }

                
                // Check status periodically
                const statusInterval = setInterval(() => {
                    let aiStatus = aiProcessor.getStatus();
                    let docgenStatus = docGenProcessor.getStatus();
                    $("#dataGeneratedJobs").text(aiStatus.totalJobs);
                    $("#dataGeneratedJobsCompleted").text(aiStatus.completedJobs);
                    $("#docgenJobs").text(docgenStatus.totalJobs);
                    $("#docgenJobsSent").text(docgenStatus.completedJobs);
                    $("#docgenJobsCompleted").text(completedBatches.size);
                    $("#docgenJobsFailed").text(completedWithErrorBatches.size);
                    if ((completedBatches.size+completedWithErrorBatches.size) >= numberOfDocs) {
                        clearInterval(statusInterval);  // Stop the first interval
                        clearInterval(docgenInterval);  // Stop the second interval
                        console.log("Intervals stopped as completedBatchSize reached the limit.");
                        loadExplorer();
                        checkButton();
                        $("#loaderGen").hide();
                    }
                    
                }, 1000);
                const docgenInterval = setInterval(()=> {
                    checkDocgenBatchJobs(docGenProcessor.getJobResults(),client);
                    $("#docgenJobsCompleted").text(completedBatches.size);
                    $("#docgenJobsFailed").text(completedWithErrorBatches.size);
                    if ((completedBatches.size+completedWithErrorBatches.size) >= numberOfDocs) {
                        clearInterval(statusInterval);  // Stop the first interval
                        clearInterval(docgenInterval);  // Stop the second interval
                        console.log("Intervals stopped as completedBatchSize reached the limit.");
                        loadExplorer();
                        checkButton();
                        $("#loaderGen").hide();
                    }

                },4000)

            });
            $(".normalHeight").on('change', function (e) {

                setIconToChanged();
            });

            $("#match").click(function () {
                let selectedTemplateKey = $(this).attr("selectedTemplate"); // Get selected template key
                let selectedTemplate = metadataTemplates.entries.find(t => t.templateKey === selectedTemplateKey); // Find the matching template
            
                if (!selectedTemplate) {
                    console.error("Selected template not found in metadataTemplates.");
                    return;
                }
            
                let fields = selectedTemplate.fields; // Extract the fields array
                let updatedJson = editor.get(); // Get the current JSON from jsoneditor
                let fieldMappings = {}; // Object to store mappings

                $(".normalHeight").each(function () { // Loop through all select elements
                    let fieldKey = $(this).data("field-key"); // Get field key from the data attribute
                    let selectedPath = $(this).val(); // Get the selected JSON path
            
                    if (!selectedPath) return; // Skip if no selection
                    fieldMappings[fieldKey] = selectedPath;

                    // Find the corresponding field definition
                    let field = fields.find(f => f.key.toLowerCase() === fieldKey.toLowerCase());
            
                    if (field && field.type === "enum") {
                        let enumOptions = field.options.map(opt => opt.key).join(", "); // Convert to comma-separated string
                        updateJsonPath(updatedJson, selectedPath, enumOptions); // Update JSON dynamically
                    }
                });
       
                editor.set(updatedJson);
                editor.options.onChange(); // Manually trigger the event
                metadataMap.push({id:$(this).attr('selectedId'),template:selectedTemplate,fieldMappings:fieldMappings});
                resetIcon();
                $("button.toggle-btn[data-bs-target='#row2']").trigger("click");

            });
            
            $('#allMDTemplates').on('change', function (e) {
                $("#fields").empty();
                var optionSelected = $("option:selected", this);
                var valueSelected = this.value;
                $("#match").attr("selectedTemplate",valueSelected);
                let template =  metadataTemplates.entries.find(t => t.templateKey === $('#allMDTemplates option:selected').val());
                generateFieldsTable(template.fields);
                //checkButton();
            }); 
            
            $('.templates').on('change',async function (e) {
                let id = this.value;
                $(this).attr('disabled',true);
                $("#match").attr('selectedId',id);
                let text = $(this).find("option:selected").text(); 
                $("#tags").empty();
                $("#fields").empty();
                $("#loader").show();
                $("#mdsection").hide();
                var valueSelected = this.value;
                //load preview on right
                var preview = new Box.ContentPreview();
				preview.show(this.value, accessToken, {
                    container:'.previewer'
                });
                //Load tags 
                //let tagsJson = await getTagsFromDoc(this.value);
                let tagsJson = await fetchTextRepresentationFromBox(this.value,accessToken);
                $("#loader").hide();
                $(this).attr('disabled',false);
                $("#textRandom").show();
                $("#tagsHeader").text("Tags for " + text);
                $("#mdsection").show();
                editor = new JSONEditor(document.getElementById('tags'), {
                    mode: 'tree', 
                    onChange: function () {
                        console.log('editor changed');
                        const obj = tagsMap.find(item => item.id === id);
                        if (obj) {
                            obj.json = editor.get();
                        } else {
                            console.warn(`ID ${id} not found in array`);
                        }
                        
                    }
                });
                
                // Set the initial JSON data
                editor.set(tagsJson);
            }); 
           
        
            metadataTemplates = await client.metadataTemplates.getEnterpriseMetadataTemplates();
            loadDocGenTemplates();
            function loadExplorer() {
                $("#files").show();
                try {
                    contentExplorer.clearCache();
                    contentExplorer.hide();
                }
                catch(error) {};
                contentExplorer.show(selectedFolder, accessToken, {
                    container: ".explorer",
                    contentPreviewProps: {
                        contentSidebarProps: {
                          detailsSidebarProps: {
                            hasNotices: true,
                            hasProperties: true,
                            hasAccessStats: true,
                            hasVersions: true
                          },
                          hasActivityFeed: true,
                          hasSkills: true,
                          hasMetadata: true
                        }
                      }

                });
            }
            function updateJsonPath(json, path, options) {
                let keys = path.split("."); // Convert dot notation into an array of keys
                let obj = json;
            
                for (let i = 0; i < keys.length - 1; i++) {
                    obj = obj[keys[i]] = obj[keys[i]] || {}; // Traverse JSON or create missing objects
                }
            
                obj[keys[keys.length - 1]] = 'Choose one of these values: ' + options; // Store the enum options as a comma-separated string
            }
            
                function checkButton() {
                        if ($('#allTemplates option').length === 0 || selectedFolder==null) {
                            $('.action').attr("disabled",true);
                        } else {
                            $('.action').attr("disabled",false);
                        }
                }
             });
           
            function sortOptions(selectBox) {
                var options = $(selectBox + ' option');
                options.sort(function(a, b) {
                    if (a.text.toLowerCase() < b.text.toLowerCase()) return -1;
                    if (a.text.toLowerCase() > b.text.toLowerCase()) return 1;
                    return 0;
                });
                $(selectBox).empty().append(options);
            }
            function setIconToChanged() {
                $("#statusIcon").removeClass("bi-check-circle").addClass("bi-exclamation-circle");
            }
        
            function resetIcon() {
                $("#statusIcon").removeClass("bi-exclamation-circle").addClass("bi-check-circle");
            }
        
        
    </script>
</head>
<body>  
     <header class="header">
    <!-- Left side links -->
    <div class="left">
        <a href="index.html">
            <i class="bi bi-house-door"></i> Home
        </a>
        <a href="index_oauth.html">
                        <i class="bi bi-box-arrow-in-right"></i> Login
        </a>
    </div>

    <!-- Center links -->
    <div class="center">
        <a href="export.html"><i class="bi bi-arrow-up-circle"></i> Export</a>
        <a href="import.html"><i class="bi bi-arrow-down-circle"></i> Import</a>
        <a href="apply.html"><i class="bi bi-check-circle"></i> Apply</a>
        <a href="delete.html" class="text-warning"><i class="bi bi-exclamation-triangle-fill text-warning"></i> Delete Template</a>
        <a href="docgen.html" class="active" ><i class="bi bi-tools"></i> Generate documents</a>


    </div>

    <!-- Right side could have more links or branding if needed -->
    <div class="right">
        <img src="pppanic.png" alt="Panic! at the Box" class="logo" width="48"  />
    </div>
</header>
    <div class="container mt-5">
        <!-- Header -->
        <header class="text-center mb-2">
            <h3>Generate documents (BETA)</h3>
        </header>
        <div class="row">
            <div class="col-md-12">
                <div class="section la">Instructions: <ul>
                    <li>This page will allow you to generate a number of documents based on existing doc gen templates and randomly generated data</li>
                    <li>Select docgen template (if you haven't got any try the button...)</li>
                    <li>Edit the tags for your docgen template. For each tag you can provide a prompt to generate the value or let the tool do it </li>
                    <li>All values are generated with Box TextGen AI API or you can choose to input exact values instead. This is useful for testing </li>
                    <li>You can also enable metadata and map a template to the fields in the docgen templates. This will apply the generated values as metadata to the completed documents </li>
                    <li>Select target folder</li>
                    <li>Select number of documents to generate and let the magic happen</li>
                </ul>
                
                    </div>
            </div>
        </div>
        <!-- Row with two sections -->
        <div class="row mb-8">
            <div class="col-md-8">                 
                   <h4>Select docgen template </h4>
            </div>
            <div class="col-md-4 text-end">
                <button class="btn btn-primary toggle-btn" data-bs-toggle="collapse" data-bs-target="#row1">[-]</button>
            </div>
        </div>
        <div id="row1" class="collapse show">
            <div class="row">
                <div class="col-md-6">
                    <div class="transfer-container section d-flex flex-column" style="height:400px !important">
                        <div class="d-flex w-100">
                            <!-- Select Box 1 -->
                            <select id="allTemplates" class="form-select flex-grow-1 templates" size="5" style="height:200px;">
                            </select>
                           
                           
                        </div>
                        <button class="btn btn-primary create" id="create">No template - no problem (experimental)</button>   

                        <!-- Tags Section Below -->
                    </div>
                </div>
            
                <div class="col-md-6">
                    
                    <div class="transfer-container section" style="height:400px !important">
                        <div class="previewer" style="height:400px !important"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mb-8">
            <div class="col-md-8">                 
                <h4 id="tagsHeader">Tags</h4>
            </div>
            <div class="col-md-4 text-end">
                <button class="btn btn-primary toggle-btn" data-bs-toggle="collapse" data-bs-target="#row2">[-]</button>
            </div>
        </div>
        <div id="row2" class="collapse show">

            <div class="row" id='tagsContainer'>
                <div class="col-md-12" id="leftCol">

                    <div class="section mt-3 d-flex flex-column">
                        
                        <div class="align-items-start" style="text-align: left; display: none;" id="textRandom">
                            <div class="form-check d-flex align-items-center">
                                <input class="form-check-input me-2" type="checkbox" id="toggleSection">
                                <label class="form-check-label me-3" for="toggleSection">Enable metadata</label><br/>
                        
                                <select class="form-select form-select-sm me-3" id="countrySelect" style="width: auto; min-width: 80px; height: auto; padding: 2px 6px;">
                                    <option value="NONE">---</option>
                                    <option value="USA">US</option>
                                    <option value="United Kingdom">UK</option>
                                    <option value="France">France</option>
                                    <option value="German">German</option>
                                    <option value="Netherlands">Netherlands</option>
                                    <option value="Japan">Japan</option>
                                    <option value="NONE">---</option>
                                    <option value="Marvel/DC">Marvel/DC</option>
                                </select>
                                <label class="form-check-label me-3" for="toggleSection">Enable country specific data</label>
                                <button class="btn btn-primary me-3" id="tryAI">See example</button>

                            </div>
                            <br/>
                            Edit the tag values. If you want to give a custom prompt like 
                            'this ID should be INV-random number' or '3 random paragraphs about contract clauses'.<br/>
                            Leave the values as is to let the built-in randomizer generate the data. Select a country if you want to instruct the AI to try to use values for that country
                            (Don't change the tag keys as these are part of the docgen template)<br/>
                            You can also enter fixed values and choose to generate a document with those exact values or remove tags if you don't need them<br/>
                            Enable metadata to apply metadata to the generated documents
                            
                        </div>
                        <div class="d-flex align-items-start">
                            
                            <img src="ajax-loader.gif" id="loader" style="display:none"/>
                            <div id="tags" class="w-100" style="text-align: left;"></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6" id="rightCol" style="display:none;">
                    <div class="section mt-3 d-flex flex-column" >
                            <!-- Select Box 1 -->
                            <div id="mdsection" style="display:none;text-align:left;">
                                Choose a metadata template and map the template with the tags. This will automatically apply the generated values
                                to the generated documents based on your mapping. Click the match button to confirm the choices
                                <select id="allMDTemplates" class="form-select"   size="8">
                                    
                                </select>
                                <div id="fields1">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Field</th>
                                                <th></th>
                                                <th>JSON Path</th>
                                            </tr>
                                        </thead>
                                        <tbody id="fieldTableBody">
                                            <!-- Table rows will be generated here dynamically -->
                                        </tbody>
                                    </table>


                                </div>
                                <div class="d-flex align-items-center gap-2">
                                    <button class="btn btn-primary" name="match" id="match" selectedTemplate="">Match with docgen tags</button>
                                    <i id="statusIcon" class="bi bi-exclamation-circle fs-4" ></i>

                                </div>
                                

                            </div>
                    </div>

                </div>
            </div>
        </div>
        <div class="row mb-8">
            <div class="col-md-8">                 
                <h4 id="folderHeader">Select target folder</h4>
            </div>
            <div class="col-md-4 text-end">
                <button class="btn btn-primary toggle-btn" data-bs-toggle="collapse" data-bs-target="#row3">[-]</button>
            </div>
        </div>
        <div id="row3" class="collapse show">

            <div class="row">
                <div class="col-md-12">

                    <div class="section mt-3 selector" style="height:500px;">
                        
                    </div>
                </div>
                
            </div>
        </div>
        

         
        <div class="button-section d-flex align-items-center gap-2">
            <label for="numberofdocs" class="mb-0">Number of docs to create:</label>
            
            <div class="d-flex align-items-center">
                
                <input class="form-control text-center" type="number" name="number" id="numberofdocs" 
                       value="1" min="1" max="999" style="width: 60px; padding: 4px;" />
                
            </div>
            <div class="mt-2">
                <label class="mb-0">Format:</label>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="docFormat" id="formatPdf" value="pdf" checked>
                    <label class="form-check-label" for="formatPdf">PDF</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="docFormat" id="formatDocx" value="docx">
                    <label class="form-check-label" for="formatDocx">DOCX</label>
                </div>
            </div>
        
            <button class="btn btn-primary action" id="generateAI" disabled >Generate with AI data</button>
            <button class="btn btn-primary action" id="generateFixed" disabled >Generate with Fixed Data</button>
            <img src="ajax-loader.gif" id="loaderGen" style="display:none"/>
        </div>
        
        <div class="row">
            <div class="col-12">
                <div class="section">
                    <h3 id="sec2"></h3>
                    <div id="sec2content">
                        <ul class="list-group">
                           
                            <li class="list-group-item">
                                Data generated for documents jobs completed
                                <span class="badge rounded-pill bg-primary counter" id="dataGeneratedJobsCompleted">0</span>
                            </li>
                          
                            <li class="list-group-item">
                                Docgen batches sent for processing
                                <span class="badge rounded-pill bg-primary counter" id="docgenJobsSent">0</span>
                            </li>
                            <li class="list-group-item">
                                Docgen batches completed successfully
                                <span class="badge rounded-pill bg-primary counter" id="docgenJobsCompleted">0</span>
                            </li>
                            <li class="list-group-item">
                                Docgen batches completed with errors
                                <span class="badge rounded-pill bg-danger counter" id="docgenJobsFailed">0</span>
                            </li>
                            
                        </ul>

                    </div>
                </div>
            </div>
        </div>
        <div class="row" id="files" style="display:none">
            <h4 id="folderHeader">View files</h4>
            <div class="col-md-12">

                <div class="section mt-3 explorer" style="height:500px;">
                    
                </div>
            </div>
            
        </div>
        <div class="modal fade" id="exampleModal" tabindex="-1000" aria-labelledby="exampleModalLabel" aria-hidden="true" style="display:none;">
            <div class="modal-dialog">
              <div class="modal-content ">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Example of AI generated values (actual values will be different for each call)</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <img src="ajax-loader.gif" id="tryLoader"/>
                  <div id="jsonview"></div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>


         
<!-- Modal -->
<div class="modal fade custom-modal" id="createModal" tabindex="-1000" aria-labelledby="createModalLabel" aria-hidden="true" style="display:none;">
    <div class="modal-dialog modal-xl custom-modal-dialog">
      <div class="modal-content custom-modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="createModalLabel">Select and existing document or upload new document. Select the document and the tool will generate the tags using AI. Then click the save button and you will have a new doc gen template</h5><br/>
          
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body custom-modal-body">
            
          <div class="custom-left-panel">
            <!-- Box File Picker -->
            <div id="box-file-picker-create" style="height:450px"></div>
          </div>
          <div class="custom-right-panel">
            <!-- JSON Viewer -->
             AI Identified tags
             <div id="jsoneditor-create"></div>
             <img src="ajax-loader.gif" id="createLoader" style="display:none;"/>
          </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="saveAsNewTemplate">Save as new doc gen template</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  

    <!-- Bootstrap JS and dependencies -->
    
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
