<head>
    <meta charset="utf-8" />
    <title>Box Interceptor Test bed</title>

    <!-- Latest version of the picker css for your locale -->
    <link rel="stylesheet" href="https://cdn01.boxcdn.net/platform/elements/22.0.0/en-US/explorer.css"/>
    <script src="https://cdn01.boxcdn.net/platform/elements/22.0.0/en-US/explorer.js"></script>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha384-tsQFqpEReu7ZLhBV2VZlAu7zcOV+rXbYlF2cqB8txI/8aZajjp4Bqd+V6D5IgvKT" crossorigin="anonymous"></script>

  </head>
  <body>
    <div id="banner" style="background-color:red;color:white;font-family:Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif"></div>
    <div class="container" style="height:100%; width: 100%;">
        
    </div>
    
    <script>
        var myResponseInterceptor = (config) => {
            //If the type of the returned data is file and the metadata is not null, then prepend a malware warning banner
            if(config.data.type && config.data.type=='file') {	
                if(config.data.metadata!=null) {
					$("#banner").text('Malware detected');
                }
			};
			return config;
		  };
		  var myRequestInterceptor = (config ) => {
            if(config.url.startsWith('https://api.box.com/2.0/files')) {
                //Clear the banner
                $("#banner").text('');
				let params = config.params;
                //Inject the metadata.global.MalwareDeepScan field into the request
				params.fields+=params.fields + ',metadata.global.MalwareDeepScan';
				config.params = params;
			}
            return config;
		  };
        var accessToken = sessionStorage.getItem("token");
        var folderId = "0";
        var explorer = new Box.ContentExplorer();
        var contentSidebarProps = {
            hasProperties: true,
            detailsSidebarProps: {
                hasNotices: true,
                hasProperties: true,
                hasAccessStats: true,
                hasVersions: true
              }
            
          };
        explorer.show(folderId, accessToken, 
        {
            "container":".container",
            "requestInterceptor":myRequestInterceptor,
            "responseInterceptor":myResponseInterceptor,
            contentPreviewProps: {
                contentSidebarProps: contentSidebarProps
            }
        });
    </script>
  </body>