<!--
author: W3layouts
author URL: http://w3layouts.com
License: Creative Commons Attribution 3.0 Unported
License URL: http://creativecommons.org/licenses/by/3.0/
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <title>Apply for credit.</title>
  <!-- for-mobile-apps -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="keywords" content="Bank Card Responsive web template, Bootstrap Web Templates, Flat Web Templates, Android Compatible web template,
Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyEricsson, Motorola web design" />


  <script>
   
      var addId;
      var idId;
      var payslipId;
      //read address into form values
      var settings = {
        "async": true,
        "crossDomain": true,
        "url": "https://api.box.com/2.0/folders/" + sessionStorage.getItem("mainFolderId") + "?fields=id,name,metadata.enterprise.kycAddress",
        "method": "GET",
        "headers": {
          "Authorization": "Bearer " + sessionStorage.getItem("accessToken")
        }
      };
      $.ajax(settings).done(function(response) {
        if (response.metadata) {
          $("#name").attr("value", response.metadata.enterprise.kycAddress.name);
          $("#email").attr("value", response.metadata.enterprise.kycAddress.emailAddress);
          $("#town").attr("value", response.metadata.enterprise.kycAddress.town);
          $("#address1").attr("value", response.metadata.enterprise.kycAddress.addressLine1);
          $("#postcode").attr("value", response.metadata.enterprise.kycAddress.postCode);
        }
      });

      $('#kyc').on('submit', (function(ev) {
        //$("#signbutton").hide();

        ev.preventDefault();

        var settings = {
          "async": true,
          "crossDomain": true,
          "url": "https://api.box.com/2.0/folders/" + sessionStorage.getItem("mainFolderId") + "?fields=id,name,metadata.enterprise.kycClient",
          "method": "GET",
          "headers": {"Authorization": "Bearer " + sessionStorage.getItem("accessToken")}
        };
        $.ajax(settings).done(function(response) {
          var hasIdValidated = "No";
          var folderId;
          console.log(response.name);
          console.log("Found name:" + response.name + ":validated?" + response.metadata.enterprise.kycClient.idVerified);
          hasIdValidated = response.metadata.enterprise.kycClient.idVerified;
          folderId = response.id;

          if (hasIdValidated == "Yes") {
            //Metdata found
            console.log("showing modal");
            $("#confirmModal").show();
            $("#confirmModal").modal()
            $(".good").show();

            window.setInterval(function() {
              window.location.replace('/Runthebank/product.html?productType=' + $("type").val());
            }, 10000);
          } else {
            //Get folder ID of address verification folders
            //apply metadata from form
            var settings = {
              "async": true,
              "crossDomain": true,
              "url": "https://api.box.com/2.0/folders/" + folderId + "/items?type=folder&fields=id,name",
              "method": "GET",
              "headers": {"Authorization": "Bearer " + sessionStorage.getItem("accessToken")}
            };
            $.ajax(settings).done(function(response) {
              $.each(response.entries, function(k, data) {
                if (data.name == 'Address Verification Documents') {
                  addId = data.id;
                  sessionStorage.setItem("addressFolderId", addId);
                }
                if (data.name == 'ID Documents') {
                  idId = data.id;
                  sessionStorage.setItem("idFolderId", idId);
                }
                if (data.name == 'Payslips') {
                  payslipId = data.id;
                  sessionStorage.setItem("payslipsFolderId", payslipId);

                }
              });
              $("#mainstuff").load("newphotob.html?d="+Math.random());
            
              
            });
          }
        });
      }));
    
  </script>

</head>

<body style="margin-left:50px;">

  <!-- header -->
  <header>
  <div style="margin-left:150px;">
      <form id="kyc" class="border border-light p-5" action="#" method="get">
        
        <p class="h4 mb-4 text-left">Emerging Funds Application</p>
        Your application is ready to proceed. Next step is to perform identity verification. 
        
       

        <ul style="margin-left:-50px;">
          <img id="loader" src="ajax-loader_t.gif" style="display:none;">
          <button id="signbutton" class="btn rolbBtn btn btn-primary marginDownMobile" type="submit" name="submit">Next</button>
        </ul>

      </form>
  </div>
  </body>

</html>
