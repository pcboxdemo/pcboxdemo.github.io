<!DOCTYPE html>
<html>

<head>
  <title>ABB MDQ</title>
  <!-- for-mobile-apps -->
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>

  <link rel="stylesheet" href="https://cdn01.boxcdn.net/platform/elements/12.0.0/en-US/explorer.css" />
  <script src="https://cdn01.boxcdn.net/platform/elements/12.0.0/en-US/explorer.js"></script>
  <script>
    var token = 'stgLffsmvxVdTvO713lndvvhLWL6QGA1';
    var boxId = "123527481698";
    var contentExplorer = new Box.ContentExplorer();
    var tab = "nav-progress";
    var status = "In Progress";
    $(document).ready(function () {
      var params = new URLSearchParams(window.location.search);
      var code = params.get('auth');
      if (code == null) {
        code = params.get('code');
      }

      $.ajax({
        method: 'get',
        //url: "https://bl2vhdoqzh.execute-api.eu-west-2.amazonaws.com/default/box-tokengenerator",
        url: "https://dik4ogwqph.execute-api.eu-west-2.amazonaws.com/default/box-node-token-generator",

        data: { authCode: code, id: params.get('id'), clientId: params.get('clientId') },
        crossDomain: true,
        cache: false,
        success: function (response) {
          console.log(response);
        },
        error: function (err) {
          console.log(JSON.stringify(err));
          console.log("error:" + err.message);
          loadTab("nav-progress", "In Progress");
        }
      });
      $("#nav-progress-tab").click(function (ev) {
        console.log("clicked");
        contentExplorer.clearCache();
        contentExplorer.hide();
        tab = "nav-progress";
        status = "In Progress";
        loadTab("nav-progress", "In Progress");
      });
      $("#nav-review-tab").click(function (ev) {
        console.log("clicked");
        contentExplorer.clearCache();
        contentExplorer.hide();
        tab = "nav-review";
        status = "Review";
        loadTab("nav-review", "Review");
      });
      $("#nav-published-tab").click(function (ev) {
        console.log("clicked");
        contentExplorer.clearCache();
        contentExplorer.hide();
        tab = "nav-published";
        status = "Published";
        loadTab("nav-published", "Published");
      });
      $("#org").change(function () {
        if ($("#org").val() != 'All') {
          contentExplorer.clearCache();
          contentExplorer.hide();
          loadTab(tab, status);
        }
      });
      $("#owner").focusout(function() {
        contentExplorer.clearCache();
          contentExplorer.hide();
          loadTab(tab, status);
      });
    });
    function loadTab(tabName, status) {
      var owner = $("#owner").val();
      var org = $("#org").val();
      console.log(owner + ":" + org);
      var query = "workflowStatus=:statusValue"
      if (owner != null && owner != "") {
        owner=owner+"%";
        query += " AND owner like :owner ";
      }
      if (org != 'All') {
        query += " AND responsibleOrganisation=:org"
      }

      const mdQuery = {
        from: "enterprise_210762180.abb",
        query: query,
        query_params: {
          "statusValue": status,
          "org": org,
          "owner": owner
        },
        ancestor_folder_id: boxId,
        fields: [
          'metadata.enterprise_210762180.abb.owner',
          'metadata.enterprise_210762180.abb.responsibleOrganisation',
          'metadata.enterprise_210762180.abb.region',
          'metadata.enterprise_210762180.abb.priorityStatus',
          'metadata.enterprise_210762180.abb.workflowStatus',
        ]
      };

      // The metadata fields/columns to view - must be valid field names from the metadata template
      const fieldsToShow = [
        { key: 'metadata.enterprise_210762180.abb.owner', canEdit: false },
        { key: 'metadata.enterprise_210762180.abb.responsibleOrganisation', canEdit: false },
        { key: 'metadata.enterprise_210762180.abb.region', canEdit: false },
        { key: 'metadata.enterprise_210762180.abb.priorityStatus', canEdit: false },
        { key: 'metadata.enterprise_210762180.abb.workflowStatus', canEdit: true }

      ];

      const defaultView = "metadata";
      contentExplorer.show(boxId, token, {
        container: '#' + tabName,
        metadataQuery: mdQuery,
        fieldsToShow: fieldsToShow,
        defaultView: defaultView
      });
    }

  </script>
  <style>
    nav>.nav.nav-tabs {

      border: none;
      color: #fff;
      background: #272e38;
      border-radius: 0;

    }

    nav>div a.nav-item.nav-link,
    nav>div a.nav-item.nav-link.active {
      border: none;
      padding: 18px 25px;
      color: #fff;
      background: #272e38;
      border-radius: 0;
    }

    nav>div a.nav-item.nav-link.active:after {
      content: "";
      position: relative;
      bottom: -60px;
      left: -10%;
      border: 15px solid transparent;
      border-top-color: #e74c3c;
    }

    .tab-content {
      background: #fdfdfd;
      line-height: 25px;
      border: 1px solid #ddd;
      border-top: 5px solid #e74c3c;
      border-bottom: 5px solid #e74c3c;
      padding: 30px 25px;
    }

    nav>div a.nav-item.nav-link:hover,
    nav>div a.nav-item.nav-link:focus {
      border: none;
      background: #e74c3c;
      color: #fff;
      border-radius: 0;
      transition: background 0.20s linear;
    }
  </style>
</head>

<body>


  <div class="container-fluid" style="height:90vh; width:95vw;">

    <div class="row">
      <div class="col-xm-2" style="margin-top:100px;">

        <form>
          <div class="form-group">
            <label for="owner">Owner (starts with)</label>
            <input type="text" class="form-control" id="owner">
          </div>
          <div class="form-group">
            <label for="org">Responsible Org</label>
            <select class="form-control" id="org">
              <option>All</option>
              <option>Clean Energy</option>
              <option>Energy industries</option>
              <option>Life Sciences</option>
              <option>Manufacturing</option>
              <option>Oil and Gas</option>
            </select>
          </div>
        </form>
      </div>
      <div class="col-xl-9">
        <nav>
          <div class="nav nav-tabs nav-fill" id="nav-tab" role="tablist">
            <a class="nav-item nav-link active" id="nav-progress-tab" data-toggle="tab" href="#nav-progress" role="tab" aria-controls="nav-progress"
              aria-selected="true">In Progress</a>
            <a class="nav-item nav-link" id="nav-review-tab" data-toggle="tab" href="#nav-review" role="tab" aria-controls="nav-review"
              aria-selected="false">Review</a>
            <a class="nav-item nav-link" id="nav-published-tab" data-toggle="tab" href="#nav-published" role="tab" aria-controls="nav-published"
              aria-selected="false">Published</a>
          </div>
        </nav>
        <div class="tab-content py-3 px-3 px-sm-0" id="nav-tabContent" style="height:700px">
          <div class="tab-pane fade show active" id="nav-progress" role="tabpanel" aria-labelledby="nav-progress-tab" style="height:700px">
            1
          </div>
          <div class="tab-pane fade" id="nav-review" role="tabpanel" aria-labelledby="nav-review-tab" style="height:700px">
            2
          </div>
          <div class="tab-pane fade" id="nav-published" role="tabpanel" aria-labelledby="nav-published-tab" style="height:700px">
            4
          </div>

        </div>

      </div>
    </div>
  </div>



</html>